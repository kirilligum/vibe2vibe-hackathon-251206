sequenceDiagram
    actor User
    participant V2V as Vibe2Vibe App
    participant Grazer as Grazer Service
    participant Agent as Coding Agent
    participant Repo as Source Code

    User->>V2V: Select Repo/Folder
    V2V->>Grazer: Request Cyclometrics Analysis
    Grazer->>Repo: Scan Files & Complexity
    Grazer-->>V2V: Return Metrics + Visuals (Red/Green)
    V2V->>V2V: Generate Refactoring Plan
    V2V->>User: Present Plan & Visualization
    User->>V2V: Approve Plan
    loop Refactoring Process
        V2V->>Agent: Assign Task (e.g. Extract Service)
        Agent->>Repo: Check agents.md (Lock/Rules)
        alt Allowed
            Agent->>Repo: Modify Code
            Agent->>Repo: Update Docs
        else Conflict
            Agent->>V2V: Report Conflict / Request Review
        end
    end
    V2V->>Grazer: Verify Post-Refactor Metrics
    Grazer-->>V2V: Comparison Report
    V2V->>User: Show Success/Diff

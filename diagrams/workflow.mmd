sequenceDiagram
    actor User
    participant PG as Prompt Gen (V2V)
    participant Grazer
    participant Agent as AI Coder
    participant Repo as Source Code

    User->>PG: Select Repo
    
    note right of PG: 1. Pre-Refactor Analysis
    PG->>Grazer: Request Metrics (Old Repo)
    Grazer->>Repo: Analyze Files & Complexity
    Grazer-->>PG: Metrics, Explanations, Mermaid
    PG->>User: Show Visualization (Red Nodes)

    PG->>PG: Plan Microservice Split
    PG->>User: Present Plan
    User->>PG: Approve Plan

    note right of PG: 2. Execution
    PG->>Agent: Execute Split Plan
    Agent->>Repo: Create Microservices / Refactor

    note right of PG: 3. Post-Refactor Verification
    PG->>Grazer: Request Metrics (New Microservices)
    Grazer->>Repo: Analyze New Structure
    Grazer-->>PG: New Metrics
    PG->>PG: Compare Old vs New
    PG->>PG: Generate Improvement Explanation
    PG->>User: Show Comparison & Success
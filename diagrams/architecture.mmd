graph TD
    User[User] -->|Provides Repo| PG[Prompt Generator / V2V]
    
    subgraph "Analysis Loop"
        PG -->|1. Request Old Metrics| Grazer[Grazer Service]
        PG -->|2. Request New Metrics| Grazer
        Grazer -->|Returns Cyclometrics & Mermaid| PG
    end

    subgraph "Execution"
        PG -->|Generates Split Plan| AgentOrch[Agent Orchestrator]
        AgentOrch -->|Spawns| Agent[AI Coder]
        Agent -->|Refactors| Repo[Source Code]
    end

    subgraph "Comparison"
        PG -->|Compares Metrics| Diff[Improvement Report]
        Diff -->|Visualized for| User
    end

    Grazer -- Analyzes --> Repo
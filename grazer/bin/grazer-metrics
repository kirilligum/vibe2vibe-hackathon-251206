#!/usr/bin/env node
import { stat } from "node:fs/promises";
import { analyzeFile, getDirectoryMetrics } from "../build/services/metrics.js";

async function main() {
    const target = process.argv[2];

    if (!target) {
        console.error("Usage: grazer-metrics <path-to-file-or-directory>");
        process.exit(1);
    }

    const info = await stat(target);
    const metrics = info.isDirectory()
        ? await getDirectoryMetrics(target)
        : await analyzeFile(target);

    console.log(JSON.stringify(metrics, null, 2));
}

main().catch((error) => {
    console.error(`Error: ${error instanceof Error ? error.message : String(error)}`);
    process.exit(1);
});
